<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Real-Time Forum</title>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         GLOBAL NAVBAR  (shown only when logged in)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <nav id="main-navbar">
      <div id="navbar-brand">Real-Time Forum</div>

      <ul id="navbar-links">
        <li><a href="#" id="nav-home">Home</a></li>
      </ul>

      <button type="button" id="nav-messages-btn" title="Messages" aria-label="Messages">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        </svg>
        <span id="nav-messages-badge" hidden></span>
      </button>

      <div id="navbar-user">
        <span id="navbar-username"></span>
        <button type="button" id="logout-btn">Log Out</button>
      </div>
    </nav>
    <!-- / main-navbar -->


    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         LOGIN PAGE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="login-page">

      <div id="login-card">

        <h1 id="login-title">Welcome Back</h1>
        <p id="login-subtitle">Sign in to your account</p>

        <form id="login-form" novalidate>

          <div class="form-group">
            <label for="login-identifier">Nickname or E-mail</label>
            <input
              type="text"
              id="login-identifier"
              name="identifier"
              placeholder="your_nickname or you@example.com"
              autocomplete="username"
            />
            <span class="field-error" id="login-identifier-error"></span>
          </div>

          <div class="form-group">
            <label for="login-password">Password</label>
            <input
              type="password"
              id="login-password"
              name="password"
              placeholder="Your password"
              autocomplete="current-password"
            />
            <span class="field-error" id="login-password-error"></span>
          </div>

          <span class="form-error" id="login-form-error"></span>

          <button type="submit" id="login-submit-btn">Sign In</button>

        </form>

        <p id="login-footer">
          Don't have an account?
          <a href="#" id="go-to-register">Create one</a>
        </p>

      </div>

    </div>
    <!-- / login-page -->


    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         REGISTRATION PAGE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="register-page">

      <div id="register-card">

        <h1 id="register-title">Create Account</h1>
        <p id="register-subtitle">Join the community today</p>

        <form id="register-form" novalidate>

          <div class="form-group">
            <label for="register-nickname">Nickname</label>
            <input
              type="text"
              id="register-nickname"
              name="nickname"
              placeholder="your_nickname"
              autocomplete="username"
            />
            <span class="field-error" id="register-nickname-error"></span>
          </div>

          <div class="form-row">

            <div class="form-group">
              <label for="register-firstname">First Name</label>
              <input
                type="text"
                id="register-firstname"
                name="firstname"
                placeholder="John"
                autocomplete="given-name"
              />
              <span class="field-error" id="register-firstname-error"></span>
            </div>

            <div class="form-group">
              <label for="register-lastname">Last Name</label>
              <input
                type="text"
                id="register-lastname"
                name="lastname"
                placeholder="Doe"
                autocomplete="family-name"
              />
              <span class="field-error" id="register-lastname-error"></span>
            </div>

          </div>

          <div class="form-group">
            <label for="register-email">E-mail</label>
            <input
              type="email"
              id="register-email"
              name="email"
              placeholder="you@example.com"
              autocomplete="email"
            />
            <span class="field-error" id="register-email-error"></span>
          </div>

          <div class="form-group">
            <label for="register-age">Age</label>
            <input
              type="number"
              id="register-age"
              name="age"
              placeholder="18"
              min="13"
              max="120"
            />
            <span class="field-error" id="register-age-error"></span>
          </div>

          <div class="form-group">
            <label>Gender</label>
            <div id="register-gender-options">
              <label class="radio-label">
                <input type="radio" name="gender" value="male" /> Male
              </label>
              <label class="radio-label">
                <input type="radio" name="gender" value="female" /> Female
              </label>
              <label class="radio-label">
                <input type="radio" name="gender" value="other" /> Other
              </label>
            </div>
            <span class="field-error" id="register-gender-error"></span>
          </div>

          <div class="form-group">
            <label for="register-password">Password</label>
            <input
              type="password"
              id="register-password"
              name="password"
              placeholder="Min 8 characters"
              autocomplete="new-password"
            />
            <span class="field-error" id="register-password-error"></span>
          </div>

          <div class="form-group">
            <label for="register-confirm-password">Confirm Password</label>
            <input
              type="password"
              id="register-confirm-password"
              name="confirm-password"
              placeholder="Repeat your password"
              autocomplete="new-password"
            />
            <span class="field-error" id="register-confirm-password-error"></span>
          </div>

          <span class="form-error" id="register-form-error"></span>

          <button type="submit" id="register-submit-btn">Create Account</button>

        </form>

        <p id="register-footer">
          Already have an account?
          <a href="#" id="go-to-login">Sign in</a>
        </p>

      </div>

    </div>
    <!-- / register-page -->


    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MAIN APP  (shown only when logged in)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <main id="app-page">

      <!-- â”€â”€ Online / Offline users sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           Spec: "visible at all times" once logged in.
           Sorted by last message, then alphabetically.
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
      <aside id="online-users-sidebar" class="sidebar--collapsed">
        <h2 id="online-users-title">Users</h2>

        <ul id="online-users-list">
          <!--
            JS injects <li> items here, each shaped like:
            <li class="user-item" data-user-id="...">
              <span class="status-dot status-dot--online / --offline"></span>
              <span class="user-item__name">nickname</span>
              <span class="user-item__badge" hidden>3</span>   unread count
            </li>
          -->
        </ul>
      </aside>
      <!-- / online-users-sidebar -->


      <!-- â”€â”€ Switchable content area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
      <div id="app-content">


        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             POSTS FEED PAGE  (#posts-page)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <section id="posts-page">

          <!-- Create post panel -->
          <div id="create-post-panel">
            <h2 id="create-post-heading">Create a Post</h2>

            <form id="create-post-form" novalidate onsubmit="event.preventDefault()">

              <div class="form-group">
                <label for="post-title">Title</label>
                <input
                  type="text"
                  id="post-title"
                  name="title"
                  placeholder="Give your post a title..."
                />
                <span class="field-error" id="post-title-error"></span>
              </div>

              <div class="form-group">
                <label>Categories</label>
                <div id="post-categories-options" class="category-checkboxes">
                  <label class="check-label"><input type="checkbox" name="postcategory" value="general" /> General</label>
                  <label class="check-label"><input type="checkbox" name="postcategory" value="technology" /> Technology</label>
                  <label class="check-label"><input type="checkbox" name="postcategory" value="sports" /> Sports</label>
                  <label class="check-label"><input type="checkbox" name="postcategory" value="gaming" /> Gaming</label>
                  <label class="check-label"><input type="checkbox" name="postcategory" value="music" /> Music</label>
                  <label class="check-label"><input type="checkbox" name="postcategory" value="art" /> Art</label>
                  <label class="check-label"><input type="checkbox" name="postcategory" value="food" /> Food</label>
                  <label class="check-label"><input type="checkbox" name="postcategory" value="travel" /> Travel</label>
                </div>
                <span class="field-error" id="post-category-error"></span>
              </div>

              <div class="form-group">
                <label for="post-content">Content</label>
                <textarea
                  id="post-content"
                  name="content"
                  placeholder="What's on your mind?"
                  rows="4"
                ></textarea>
                <span class="field-error" id="post-content-error"></span>
              </div>

              <span class="form-error" id="create-post-error"></span>

              <button type="submit" id="create-post-submit" class="btn btn--primary">Publish Post</button>

            </form>
          </div>
          <!-- / create-post-panel -->


          <!-- Category filter bar -->
          <nav id="posts-filter-bar" aria-label="Filter posts">
            <button class="filter-btn filter-btn--active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="mine">My Posts</button>
            <button class="filter-btn" data-filter="liked">Liked</button>
            <span class="filter-sep"></span>
            <button class="filter-btn" data-category="general">General</button>
            <button class="filter-btn" data-category="technology">Technology</button>
            <button class="filter-btn" data-category="sports">Sports</button>
            <button class="filter-btn" data-category="gaming">Gaming</button>
            <button class="filter-btn" data-category="music">Music</button>
            <button class="filter-btn" data-category="art">Art</button>
            <button class="filter-btn" data-category="food">Food</button>
            <button class="filter-btn" data-category="travel">Travel</button>
          </nav>


          <!-- Posts feed â€” JS injects post cards here -->
          <div id="posts-feed">
            <!--
              JS injects <article class="post-card" data-post-id="..."> items.
              Clicking a card navigates to #post-detail-page.
            -->
            <p id="posts-feed-empty" hidden>No posts yet â€” be the first!</p>
          </div>

        </section>
        <!-- / posts-page -->


        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             SINGLE POST + COMMENTS  (#post-detail-page)
             Shown when user clicks a post card.
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <section id="post-detail-page">

          <button type="button" id="back-to-posts-btn">&larr; Back to Posts</button>

          <!-- Full post content â€” JS fills this -->
          <article id="post-detail-content">
            <!--
              JS renders:
                <header>  author avatar + name + date + category badge  </header>
                <h1>      post title                                     </h1>
                <p>       post body                                      </p>
            -->
          </article>


          <!-- Comments section -->
          <section id="comments-section">

            <h3 id="comments-heading">Comments</h3>

            <!-- Add comment form -->
            <form id="add-comment-form" novalidate onsubmit="event.preventDefault()">
              <div class="form-group">
                <label for="comment-input">Write a comment</label>
                <textarea
                  id="comment-input"
                  name="comment"
                  placeholder="Share your thoughts..."
                  rows="3"
                ></textarea>
                <span class="field-error" id="comment-input-error"></span>
              </div>
            </form>

            <!-- Comments list â€” JS injects comment items here -->
            <div id="comments-list">
              <!--
                JS renders:
                  <div class="comment" data-comment-id="...">
                    <span class="comment__author">nickname</span>
                    <span class="comment__date">date</span>
                    <p class="comment__text">body</p>
                  </div>
              -->
              <p id="comments-empty" hidden>No comments yet â€” start the conversation!</p>
            </div>

          </section>
          <!-- / comments-section -->

        </section>
        <!-- / post-detail-page -->


        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             CHAT / PRIVATE MESSAGES  (#chat-panel)
             Opened when a user is clicked in the sidebar.
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <section id="chat-panel">

          <!-- No conversation selected yet -->
          <div id="chat-placeholder">
            <span id="chat-placeholder-icon">ðŸ’¬</span>
            <p>Select a user from the sidebar to start chatting</p>
          </div>

          <!-- Active conversation (hidden until a user is selected) -->
          <div id="chat-conversation">

            <!-- Conversation header -->
            <header id="chat-conversation-header">
              <button type="button" id="chat-back-btn">&larr;</button>
              <span id="chat-partner-status" class="status-dot"></span>
              <strong id="chat-partner-name"></strong>
            </header>

            <!-- Scrollable messages area
                 Scroll-up triggers throttled load of 10 older messages -->
            <div id="chat-messages-area">
              <div id="chat-load-more-trigger">
                <!-- JS inserts a sentinel element here for IntersectionObserver -->
              </div>
              <p id="chat-no-more-messages" hidden>Beginning of conversation</p>
              <!--
                JS renders:
                  <div class="chat-msg chat-msg--mine / --theirs" data-msg-id="...">
                    <span class="chat-msg__author">nickname</span>
                    <p   class="chat-msg__text">body</p>
                    <time class="chat-msg__date">HH:MM Â· DD MMM YYYY</time>
                  </div>
              -->
            </div>

            <!-- Message input -->
            <form id="chat-input-form" novalidate onsubmit="event.preventDefault()">
              <textarea
                id="chat-input"
                name="message"
                placeholder="Type a messageâ€¦"
                rows="1"
              ></textarea>
              <button type="submit" id="chat-send-btn" aria-label="Send message">Send</button>
            </form>

          </div>
          <!-- / chat-conversation -->

        </section>
        <!-- / chat-panel -->


      </div>
      <!-- / app-content -->

    </main>
    <!-- / app-page -->


    <script>
      // â”€â”€ Page router â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Call showPage('login' | 'register' | 'app') from any JS file.
      const pages = {
        login   : document.getElementById('login-page'),
        register: document.getElementById('register-page'),
        app     : document.getElementById('app-page'),
      };
      const navbar = document.getElementById('main-navbar');

      function showPage(name) {
        Object.values(pages).forEach(p => p.style.display = 'none');
        pages[name].style.display = (name === 'app') ? 'flex' : 'flex';
        navbar.style.display = (name === 'app') ? 'flex' : 'none';
        document.body.style.overflow = (name === 'app') ? 'hidden' : 'auto';
        if (name === 'app') {
          if (typeof loadPosts === 'function') loadPosts();
          if (typeof initChat  === 'function') initChat();
        }
      }

      // On first load: restore session or show login
      const saved = sessionStorage.getItem('user');
      if (saved) {
        document.getElementById('navbar-username').textContent = JSON.parse(saved).nickname;
        showPage('app');
      } else {
        showPage('login');
      }
    </script>

    <script src="Login.js"></script>
    <script src="Registration.js"></script>
    <script src="Posts.js"></script>
    <script src="PostDetail.js"></script>
    <script src="Chat.js"></script>
    <script>
      if (sessionStorage.getItem('user')) loadPosts();
    </script>
  </body>
</html>
